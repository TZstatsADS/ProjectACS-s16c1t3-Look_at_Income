---
title: "geo"
author:yueying Teng
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
#average total person incoem in each state plot on current location when data is provided
#average total person income plot according to birthplace

library(dplyr)
library(data.table)
# use stwd to change the working directory 

setwd("~/Downloads/2013-american-community-survey/pums")

# read .csv files and make complete datasets
pdata1 <- fread("ss13pusa.csv")
pdata2 <- fread("ss13pusb.csv")
pus <- rbind(pdata1, pdata2)

# pick up needed variables
income <- select(pus, ADJINC, WAGP, PINCP,ST)

save(income, file = "income.RData")




load("/Users/yueyingteng/Downloads/2013-american-community-survey/pums/income.RData")

library(dplyr)

# adjust PINCP by ADJINC and create a new column called real for it in income dataset
income$real <- as.numeric(income$ADJINC) * 10^(-6) * as.numeric(income$PINCP)

# match ST in income data set to actual statename in ST.anno
income<- tbl_df(income) 
ST.anno<-read.csv("/Users/yueyingteng/Documents/4249/cycle1-3/data/statenames.csv")
income <- inner_join(income, ST.anno, by = c("ST" = "code"))


# select adjusted total person income and statename from income dataset
income2<-select(income,real,name)

# remove all missing values
income3 <- subset(income2, !is.na(real))

# calculate average adjusted PINCP according to state
meanincome<-aggregate(real~name, data=income3, FUN=function(income3) c(mean=mean(income3), count=length(income3)))
```

```{r}
library(googleVis)
GeoStates <- gvisGeoChart(meanincome, "name", "real",
                          options=list(region="US", 
                                       displayMode="regions", 
                                       resolution="provinces",
                                       width=600, height=400))
plot(GeoStates)
```


####################################


library(dplyr)
library(data.table)
# use stwd to change the working directory to the one speciifed in the brackets

setwd("~/Downloads/2013-american-community-survey/pums")

# read .csv files and make complete datasets

pdata1 <- fread("ss13pusa.csv")
pdata2 <- fread("ss13pusb.csv")
pus <- rbind(pdata1, pdata2)

# pick up needed variables

relation <- select(pus, POBP,ST, ADJINC, PINCP)

save(relation, file = "relation.RData")




load("/Users/yueyingteng/Downloads/2013-american-community-survey/pums/relation.RData")


relation<- tbl_df(relation) 
ST.anno<-read.csv("/Users/yueyingteng/Documents/4249/cycle1-3/data/statenames.csv")
relation <- inner_join(relation, ST.anno, by = c("POBP" = "code"))


# adjust PINCP by ADJINC and create a new column called real for it in relation dataset
relation$realpobp <- as.numeric(relation$ADJINC) * 10^(-6) * as.numeric(relation$PINCP)


# select adjusted total person income and statename from relation dataset
relation2<-select(relation,realpobp,name)

# remove all missing values
relation3 <- subset(relation2, !is.na(realpobp))

# calculate average adjusted PINCP according to individual's birthplace 
meanincomepobp<-aggregate(realpobp~name, data=relation3, FUN=function(relation3) c(mean=mean(relation3), count=length(relation3)))
```

```{r}
library(googleVis)
GeoStates2 <- gvisGeoChart(meanincomepobp, "name", "realpobp",
                          options=list(region="US", 
                                       displayMode="regions", 
                                       resolution="provinces",
                                       width=600, height=400))
plot(GeoStates2)

```


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
